<?php
/* Базовые функции для работы с бд */

/**
 * Выполняет запрос
 *@param $query - запрос
 *@return 1 - если запрос успешно
 *        EBASE - если запрос не выполнен
 *        data - возвращает ассоциативный массив как результат запроса
 */
function db_query($query)
{
	global $link;
	$data = array();
	$row = array();
	
	$result = mysqli_query($link, $query);
	if($result === TRUE)
		return 1;
	if($result === FALSE)
		return EBASE;
		
	while($row = mysqli_fetch_assoc($result))
		$data[] = $row;
	return $data;
}


/** 
 * Добавляет запись в БД
 * @param $table_name - имя таблицы для добавления
 * @param $array - массив данных для добавления
 * @return EBASE - в случае неудачи
 * @return $id - возвращает id вставленной записи
 */
function db_insert($table_name, $array)
{
	
	global $link;
	$query = "INSERT INTO " . $table_name . " SET ";
	$separator = '';
	foreach ($array as $field => $value) {
		if($field == 'id')
			continue;
		$query .= $separator . $field . ' = "' . $value . '"';
		$separator = ',';
	}
	$result = mysqli_query($link, $query);
	if($result === FALSE)
		return EBASE;
	else
		return mysqli_insert_id($link);
}



/**
 * Обновляет данные в БД с указанным id
 * @param $table - имя таблицы для обновления
 * @param $id - id записи для обновления
 * @param $array - массив данных для обновления
 * @return EBASE - в случае неудачи
 *         0 - в случае удачного обновления
 */
function db_update($table, $id, $array)
{
	global $link;
	$separator = '';
	$query = "UPDATE " . $table . " SET "; 
	foreach($array as $field	 => $value) {
		$query .= $separator . $field . ' = "' . $value . '"';
		$separator = ',';
	}
	$query .= " WHERE id = " . $id;
	$update = mysqli_query($link, $query);
	if($update)
	   return 0;
	else 
	   return EBASE;
	
}


/**
 * Закрывает ранее открытое соединение с базой данных
 * @return EBASE - в случае ошибки
 * @return 1 - в случае успеха
 */
function db_close()
{
	global $link;
	if(!mysqli_close($link))
	   return EBASE;
	else 
	return 1;	
}

?>